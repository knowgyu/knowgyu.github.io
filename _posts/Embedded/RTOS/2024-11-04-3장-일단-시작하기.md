---
title: "[RTOSê°œë°œ] 3ì¥ ì¼ë‹¨ ì‹œì‘í•˜ê¸°"
author: knowgyu
description: " "
date: 2024-10-05 06:03:14 +0900
math: true
categories: [Embedded System, ì„ë² ë””ë“œ OS ê°œë°œ í”„ë¡œì íŠ¸]
tags: [Embedded System, RTOS, Firmware, OS]
---

![image.png](/assets/img/OS/OS000.jpg){: .w-25}
<br>

**ë³¸ í”„ë¡œì íŠ¸ëŠ” ì´ë§Œìš° ì €ìë‹˜ì˜ "ì„ë² ë””ë“œ OS ê°œë°œ í”„ë¡œì íŠ¸" êµì¬ë¥¼ ë”°ë¼ RTOSë¥¼ ë§Œë“œëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.**

<br>

***

ë³¸ í˜ì´ì§€ì—ì„  ì§ì ‘ ì½”ë“œë¥¼ ì‘ì„±í•´ íŒì›¨ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œë³´ëŠ” ê²ƒì— ëŒ€í•´ ë‹¤ë£¹ë‹ˆë‹¤.

## ì„œë¡ 
***
ì´ ì¥ì˜ ì†ŒìŠ¤ ì½”ë“œëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
$ wget https://github.com/navilera/Navilos/archive/95f2b8d.zip # 1ì ˆ
$ wget https://github.com/navilera/Navilos/archive/d99603c.zip # 3ì ˆ
$ wget https://github.com/navilera/Navilos/archive/be7a34c.zip # 4ì ˆ
$ wget https://github.com/navilera/Navilos/archive/0ea7fe7.zip # 5ì ˆ
```
## ë¦¬ì…‹ ë²¡í„°
***
- ARM ì½”ì–´ì— ì „ì›ì´ ë“¤ì–´ê°€ë©´ ê°€ì¥ ë¨¼ì € í•˜ëŠ” ì¼ì€ ë¦¬ì…‹ ë²¡í„°ì— ìˆëŠ” ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒ
  - **ë¦¬ì…‹ ë²¡í„° = ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x00000000**
  - ì „ì›ì´ ë“¤ì–´ì˜¤ë©´ ê°€ì¥ ë¨¼ì € ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x00000000ì—ì„œ 32ë¹„íŠ¸ë¥¼ ì½ì–´ì„œ ëª…ë ¹ì„ ë°”ë¡œ ì‹¤í–‰

- ìš°ë¦¬ê°€ í•´ì•¼ í•  ì¼: ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x00000000ì— ëª…ë ¹ì–´ ë„£ê¸°
  - bootë¼ëŠ” ì´ë¦„ì˜ ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³ , `Entry.S`ë¼ëŠ” ì½”ë“œ ì‘ì„±

```bash
$ mkdir boot && cd boot
$ vi Entry.S
```

### `Entry.S`

```bash
.text
  .code 32

  .global vector_start
  .global vector_end

  vector_start:
    LDR R0, =0x10000000
    LDR R1, [R0]
  vector_end:
    .space 1024, 0
.end
```

![ì½”ë“œ ì˜ˆì‹œ ì´ë¯¸ì§€](/assets/img/OS/os201.png)

- ì½”ë“œì˜ ì²˜ìŒê³¼ ëì— ìˆëŠ” `.text`ì™€ `.end`ëŠ” ê·¸ ì‚¬ì´ì— ìˆëŠ” ì½”ë“œê°€ text ì„¹ì…˜ì„ì„ ì˜ë¯¸
- ì‹¤í–‰ íŒŒì¼: ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ êµ¬ì„±í•˜ëŠ” ìš”ì†Œë¥¼ íŒŒì¼ ì‹œìŠ¤í…œì— ë°”ì´ë„ˆë¦¬ë¡œ ë§Œë“  ê²ƒ
  - ì†Œí”„íŠ¸ì›¨ì–´ëŠ” **ë°ì´í„°**ì™€ ê·¸ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” **ì½”ë“œ**ë¡œ êµ¬ì„±
  - ì„ ì–¸í•˜ëŠ” ë³€ìˆ˜ = ë°ì´í„°, ë³€ìˆ˜ì˜ ê°’ì„ ë³€ê²½í•˜ëŠ” ë¡œì§ = ì½”ë“œ
  - ì½”ë“œë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ë³€ê²½í•´ ëª¨ì•„ ë†“ì€ ê²ƒì„ **text ì„¹ì…˜**ì´ë¼ ë¶€ë¦„

ğŸ’¡ `.text`: ì»´íŒŒì¼ëŸ¬ê°€ ë§Œë“  ê¸°ê³„ì–´ê°€ ìœ„ì¹˜í•˜ëŠ” ì„¹ì…˜. ì»´íŒŒì¼ëŸ¬ê°€ ìƒì„±í•œ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ì—­ì–´ì…ˆë¸”í•˜ë©´ ì–´ì…ˆë¸”ë¦¬ì–´ê°€ ë‚˜ì˜¤ëŠ”ë°, ê·¸ ì–´ì…ˆë¸”ë¦¬ì–´ê°€ ë°”ë¡œ .text ì„¹ì…˜ì˜ ê¸°ê³„ì–´ë¥¼ ì–´ì…ˆë¸”ë¦¬ì–´ë¡œ ë°”ê¾¼ ì¶œë ¥ ê²°ê³¼

- `.code 32`: ëª…ë ¹ì–´ í¬ê¸°ê°€ 32ë¹„íŠ¸
- `.global`: Cì–¸ì–´ì˜ `.extern`ê³¼ ê°™ì´ ì™¸ë¶€ íŒŒì¼ì—ì„œ ì½ì„ ìˆ˜ ìˆë„ë¡ í•¨
- `vector_start`: ë ˆì´ë¸” ì„ ì–¸
- `MOV R0, R1`: ë ˆì§€ìŠ¤í„° R1ì˜ ê°’ì„ R0ì— ë„£ìŒ (R0, R1ì€ ë ˆì§€ìŠ¤í„° ì´ë¦„)
- `vector_end`: ë ˆì´ë¸” ì„ ì–¸
- `.space 1024, 0`: í•´ë‹¹ ìœ„ì¹˜ë¶€í„° 1024ë°”ì´íŠ¸ë¥¼ 0ìœ¼ë¡œ ì±„ì›€

- ìœ„ ì½”ë“œì˜ ì˜ë¯¸:
  - ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x00000000ì—ëŠ” `MOV R0, R1`
  - 0x00000004ë¶€í„° 0x00000400ê¹Œì§€ëŠ” 0ìœ¼ë¡œ ì±„ì›€

- ì´ ì½”ë“œë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ `Entry.S`ë¥¼ ì–´ì…ˆë¸”ëŸ¬ë¡œ ì»´íŒŒì¼ í›„ í™•ì¸

### `Entry.S`ë¥¼ ì»´íŒŒì¼ í›„ í™•ì¸

```bash
$ arm-none-eabi-as -march=armv7-a -mcpu=cortex-a8 -o Entry.o ./Entry.S
$ arm-none-eabi-objcopy -O binary Entry.o Entry.bin
$ hexdump Entry.bin
```

![ì»´íŒŒì¼ ê²°ê³¼ ì´ë¯¸ì§€](/assets/img/OS/os202.png)

- 1ë²ˆì§¸ ì¤„: ì–´ì…ˆë¸”ë¦¬ì–´ ì†ŒìŠ¤ íŒŒì¼ì„ ì»´íŒŒì¼í•˜ëŠ” ëª…ë ¹ì–´
  - GCC í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ ì„¤ì¹˜ ì‹œ í•¨ê»˜ ì„¤ì¹˜ëœ ARMìš© ì–´ì…ˆë¸”ëŸ¬ ì‚¬ìš©
  - ì»´íŒŒì¼ ì„±ê³µ ì‹œ `Entry.o`ë¼ëŠ” íŒŒì¼ ìƒì„±
- 2ë²ˆì§¸ ì¤„: `Entry.o`ì—ì„œ ë°”ì´ë„ˆë¦¬ë§Œ ì¶”ì¶œí•˜ì—¬ `Entry.bin`ì— ì €ì¥
- 3ë²ˆì§¸ ì¤„: `Entry.bin` ë‚´ìš©ì„ `hexdump` ëª…ë ¹ì–´ë¡œ í™•ì¸
  - `0001 e1a0`: ê¸°ê³„ì–´ë¡œ `MOV R0, R1` ì˜ë¯¸
  - ì˜ˆì¸¡í•œ ëŒ€ë¡œ 0x00000400ê¹Œì§€ 0ìœ¼ë¡œ ì±„ì›Œì§ í™•ì¸

## ì‹¤í–‰ íŒŒì¼ ë§Œë“¤ê¸°
***
- QEMUê°€ íŒì›¨ì–´ íŒŒì¼ì„ ì½ì–´ ë¶€íŒ…í•˜ë ¤ë©´ **ELF íŒŒì¼ í˜•ì‹**ì´ì–´ì•¼ í•¨
  - ELF íŒŒì¼ì„ ë§Œë“¤ê¸° ìœ„í•´ ë§ì»¤(Linker)ì˜ ë„ì›€ì´ í•„ìš”
  - ë§ì»¤: ì—¬ëŸ¬ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì„ ë¬¶ì–´ í•˜ë‚˜ì˜ ì‹¤í–‰ íŒŒì¼ë¡œ ë§Œë“œëŠ” í”„ë¡œê·¸ë¨
  - ë§ì»¤ê°€ ë™ì‘í•˜ë ¤ë©´ ë§ì»¤ì— ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” **ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸** í•„ìš”

### ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸ `navilos.ld`

```bash
$ vi navilos.ld
```

```bash
ENTRY(vector_start)
SECTIONS
{
  . = 0x0;

  .text :
  {
    *(vector_start)
    *(.text .rodata)
  }
  .data :
  {
    *(.data)
  }
  .bss :
  {
    *(.bss)
  }
}
```

- 1ë²ˆì§¸ ì¤„: `ENTRY` ì§€ì‹œì–´ë¡œ ì‹œì‘ ìœ„ì¹˜ì˜ ì‹¬ë²Œ ì§€ì •
- 2ë²ˆì§¸ ì¤„: `SECTIONS` ì§€ì‹œì–´ë¡œ 3~20ë²ˆì§¸ ì¤„ê¹Œì§€ì˜ ë¸”ë¡ì´ ì„¹ì…˜ ë°°ì¹˜ ì„¤ì • ì •ë³´ ê°€ì§
- 4ë²ˆì§¸ ì¤„: `. = 0x0;` - ì²« ë²ˆì§¸ ì„¹ì…˜ì´ ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x00000000ì— ìœ„ì¹˜í•˜ë„ë¡ ì§€ì •
- ì´í›„ `.text`, `.data`, `.bss` ì„¹ì…˜ì€ ì—°ì†ëœ ë©”ëª¨ë¦¬ì— ë°°ì¹˜ë˜ë„ë¡ ì„¤ì •
  - `.text` ì„¹ì…˜ì—ëŠ” ë¦¬ì…‹ ë²¡í„°ê°€ ìœ„ì¹˜í•´ì•¼ í•˜ë¯€ë¡œ `vector_start` ì‹¬ë²Œì´ ë¨¼ì € ë‚˜ì˜´

### ë§ì»¤ë¡œ ì‹¤í–‰ íŒŒì¼ ë§Œë“¤ê¸°

```bash
$ arm-none-eabi-ld -n -T ./navilos.ld -nostdlib -o navilos.axf Entry.o
$ arm-none-eabi-objdump -D navilos.axf
```

![ë§ì»¤ ê²°ê³¼ ì´ë¯¸ì§€](/assets/img/OS/os203.png)

- 1ë²ˆì§¸ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰ íŒŒì¼ ìƒì„±
  - `-n`: ë§ì»¤ì— ì„¹ì…˜ì˜ ì •ë ¬ì„ ìë™ìœ¼ë¡œ ë§ì¶”ì§€ ì•Šë„ë¡ ì§€ì‹œ
  - `-T`: ë§ì»¤ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ëª… ì§€ì •
  - `-nostdlib`: í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§í‚¹í•˜ì§€ ì•Šë„ë¡ ì„¤ì •
- ë™ì‘ ì™„ë£Œ í›„ `navilos.axf` íŒŒì¼ ìƒì„±
- 2ë²ˆì§¸ ëª…ë ¹ì–´: ì´ íŒŒì¼ì„ ë””ìŠ¤ì–´ì…ˆë¸”í•˜ì—¬ ë‚´ë¶€ë¥¼ ì¶œë ¥

## QEMUì—ì„œ ì‹¤í–‰í•´ ë³´ê¸°
***
- ì‹¤í–‰ íŒŒì¼ ìƒì„± ì„±ê³µ, í•˜ì§€ë§Œ í˜„ì¬ íŒŒì¼ì€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

![ì‹¤í–‰ ë¶ˆê°€ ì´ë¯¸ì§€ 1](/assets/img/OS/os204.png)
![ì‹¤í–‰ ë¶ˆê°€ ì´ë¯¸ì§€ 2](/assets/img/OS/os205.png)

- ELF íŒŒì¼ í˜•ì‹ìœ¼ë¡œ ë§Œë“  ì‹¤í–‰ íŒŒì¼ì´ ë§ì§€ë§Œ, ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ì„¹ì…˜ ë°°ì¹˜ë¡œ ë§Œë“¤ì–´ì§
- ì‹¤í–‰ì„ ìœ„í•´ ARM ê°œë°œ ë³´ë“œì— ë‹¤ìš´ë¡œë“œí•´ ë™ì‘ì„ í™•ì¸í•˜ê±°ë‚˜ QEMUë¡œ ì‹¤í–‰ ê°€ëŠ¥

### QEMUë¡œ ì‹¤í–‰í•´ ë³´ê¸°

```bash
$ qemu-system-arm -M realview-pb-a8 -kernel navilos.axf -S -gdb tcp::1234,ipv4
```

![QEMU ì‹¤í–‰ ì´ë¯¸ì§€ 1](/assets/img/OS/os206.png)
![QEMU ì‹¤í–‰ ì´ë¯¸ì§€ 2](/assets/img/OS/os207.png)

- `-S`: QEMUê°€ ë™ì‘í•˜ìë§ˆì ì¼ì‹œì •ì§€ì‹œí‚¤ëŠ” ì˜µì…˜
- `gdb tcp::1234,ipv4` ì˜µì…˜ìœ¼ë¡œ gdbì™€ ì—°ê²°
  - QEMUë¡œ ì‹¤í–‰í–ˆì„ ë•Œ í™”ë©´ì— ì•„ë¬´ê²ƒë„ ì¶œë ¥ë˜ì§€ ì•Šì•„ í™•ì¸ì„ ìœ„í•´ ì‚¬ìš©
- ì´ì œ gdbë¥¼ ì´ìš©í•´ QEMUì™€ ì—°ê²°í•˜ì—¬ ë””ë²„ê¹… ì§„í–‰

ğŸ’¡ ê¸°ì¡´ í„°ë¯¸ë„ì„ ìœ ì§€í•œ ì±„, ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì‹¤í–‰í•˜ì—¬ ì§„í–‰. ê²½ë¡œì— ì£¼ì˜.

### gdbì™€ QEMU ì—°ê²°í•˜ê¸°
***

```bash
# gdb ì„¤ì¹˜ í›„ QEMUì™€ ì—°ê²°
$ sudo apt install gdb-multiarch
$ gdb-multiarch navilos.axf
```

![gdb ì‹¤í–‰ ì´ë¯¸ì§€](/assets/img/OS/os208.png)

- `target remote:1234`ë¡œ QEMUì™€ ì—°ê²° í›„, `x/4b 0` ëª…ë ¹ì–´ë¡œ 0x00000000 ë©”ëª¨ë¦¬ ì£¼ì†Œì—ì„œ 4ë°”ì´íŠ¸ ì¶œë ¥
  - ì´ì „ `MOV R0, R1` ê²°ê³¼ì™€ ì¼ì¹˜ (`0xE1A00001`)
  - ì½”ë“œ ë°ì´í„°ê°€ QEMU ë©”ëª¨ë¦¬ì— ì œëŒ€ë¡œ ë‹¤ìš´ë¡œë“œë¨ì„ í™•ì¸

> ğŸ’¡ íŒì›¨ì–´ì™€ RTOS ê°œë°œì˜ í•µì‹¬ì€ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ë¹Œë“œ, ë””ë²„ê¹…í•˜ëŠ” ê³¼ì •ì„ ë°˜ë³µí•˜ëŠ” ê²ƒì„ 
{: .prompt-tip }

![navilos.ld íŒŒì¼ ê²½ë¡œ ìˆ˜ì • ì´ë¯¸ì§€](/assets/img/OS/os209.png)

## ë¹Œë“œ ìë™í™”í•˜ê¸°
***
- `navilos.axf` ì‹¤í–‰ íŒŒì¼ì„ ì–»ê¸° ìœ„í•´ ë§¤ë²ˆ ì»´íŒŒì¼ ë° ë§í‚¹ì„ ìˆ˜ë™ìœ¼ë¡œ í•˜ê¸°ì—ëŠ” ë¹„íš¨ìœ¨ì ì„
- **Makefile**ì„ ì´ìš©í•´ ë¹Œë“œ ìë™í™” ìˆ˜í–‰

### Makefile ì˜ˆì‹œ

```bash
ARCH = armv7-a
MCPU = cortex-a8

CC = arm-none-eabi-gcc
AS = arm-none-eabi-as
LD = arm-none-eabi-ld
OC = arm-none-eabi-objcopy

LINKER_SCRIPT = ./navilos.ld

ASM_SRCS = $(wildcard boot/*.S)
ASM_OBJS = $(patsubst boot/%.S, build/%.o, $(ASM_SRCS))

navilos = build/navilos.axf
...

.PHONY: all clean run debug gdb

all: $(navilos)

clean:
	@rm -fr build

run: $(navilos)
	qemu-system-arm -M realview-pb-a8 -kernel $(navilos)

debug: $(navilos)
	qemu-system-arm -M realview-pb-a8 -kernel $(navilos) -S -gdb tcp::1234,ipv4
```

- 1~2ë²ˆì§¸ ì¤„: RealViewPBì˜ ì•„í‚¤í…ì²˜ì™€ CPU ì •ë³´
- 4~7ë²ˆì§¸ ì¤„: í¬ë¡œìŠ¤ ì»´íŒŒì¼ëŸ¬ ì‹¤í–‰ íŒŒì¼ ì •ì˜ (íˆ´ ì²´ì¸)

- `make` ëª…ë ¹ì–´ë¡œ ë¹Œë“œ ìë™í™” ì‹¤í–‰

```bash
$ make all
```

![make ì‹¤í–‰ ì´ë¯¸ì§€](/assets/img/OS/os210.png)

> ğŸ’¡ `build` í´ë”ì— ì˜¤ë¸Œì íŠ¸ íŒŒì¼, ë°”ì´ë„ˆë¦¬ íŒŒì¼, ì‹¤í–‰ íŒŒì¼ì´ ìƒì„±ë¨ 
{: .prompt-tip }

```bash
$ make debug
```

![QEMU ë””ë²„ê·¸ ì‹¤í–‰ ì´ë¯¸ì§€](/assets/img/OS/os211.png)

> ğŸ’¡ QEMUê°€ ì‹¤í–‰ë¨ 
{: .prompt-tip }


- í˜„ì¬ê¹Œì§€ì˜ ì½”ë“œ íŠ¸ë¦¬

![ì½”ë“œ íŠ¸ë¦¬ ì´ë¯¸ì§€](/assets/img/OS/os212.png)

## í•˜ë“œì›¨ì–´ ì •ë³´ ì½ì–´ì˜¤ê¸° - ë°ì´í„°ì‹œíŠ¸ë¥¼ ì½ëŠ” ë°©ë²•
***
- ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ê²°êµ­ í•˜ë“œì›¨ì–´ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê²ƒì´ ëª©ì 
  - íŒì›¨ì–´ëŠ” í•˜ë“œì›¨ì–´ì™€ ë°€ì ‘í•˜ê²Œ ì—°ë™ë¨
  - í•˜ë“œì›¨ì–´ì™€ì˜ ìƒí˜¸ì‘ìš©: ì •ë³´ë¥¼ ì½ê³  ì“°ëŠ” ì‘ì—… (ë ˆì§€ìŠ¤í„° ì‚¬ìš©)

### ë ˆì§€ìŠ¤í„°: í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ ê°„ ì¸í„°í˜ì´ìŠ¤
- í•˜ë“œì›¨ì–´ì˜ ë ˆì§€ìŠ¤í„° ì‚¬ìš©ë²•ì€ ë°ì´í„°ì‹œíŠ¸ì— ì„¤ëª…ë˜ì–´ ìˆìŒ
- í•˜ë“œì›¨ì–´ì—ì„œ ì •ë³´ë¥¼ ì½ì–´ì˜¤ëŠ” ê°„ë‹¨í•œ ì‘ì—… ìˆ˜í–‰

### Entry.S ì½”ë“œ ìˆ˜ì •

```bash
.text
  .code 32

  .global vector_start
  .global vector_end

  vector_start:
    LDR R0, =0x10000000
    LDR R1, [R0]
  vector_end:
    .space 1024, 0
.end
```

- 8ë²ˆì§¸ ì¤„: R0ì— 0x10000000 ì €ì¥
- 9ë²ˆì§¸ ì¤„: R0ì— ì €ì¥ëœ ë©”ëª¨ë¦¬ ì£¼ì†Œì—ì„œ ê°’ì„ ì½ì–´ R1ì— ì €ì¥
- ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x10000000ì˜ ê°’ì€ RealViewPBì˜ ë°ì´í„°ì‹œíŠ¸ë¥¼ í†µí•´ í™•ì¸

![ë°ì´í„°ì‹œíŠ¸ ì´ë¯¸ì§€ 1](/assets/img/OS/os213.png)
![ë°ì´í„°ì‹œíŠ¸ ì´ë¯¸ì§€ 2](/assets/img/OS/os214.png)

- 0x10000000ì€ ID ë ˆì§€ìŠ¤í„°ë¡œ, í•˜ë“œì›¨ì–´ ì‹ë³„ ì •ë³´ë¥¼ ê°€ì§ (SYS_ID)
- SYS_IDëŠ” 32ë¹„íŠ¸ë¥¼ 5ê°œì˜ í•„ë“œë¡œ ë‚˜ëˆ„ì–´ ì‚¬ìš©
  - **REV**: ë³´ë“œ ë²„ì „
  - **HBI**: ë³´ë“œ ë²ˆí˜¸ (ê¸°ë³¸ê°’ 0x178)
  - **BUILD**: ë¹Œë“œ ë³€í˜•
  - **ARCH**: ë²„ìŠ¤ ì•„í‚¤í…ì²˜ (ê¸°ë³¸ê°’ 0x5)
  - **FPGA**: FPGA ë¹Œë“œ

> ë°ì´í„°ì‹œíŠ¸ëŠ” ë³´í†µ ì„¤ëª…ë§Œ ì œê³µí•˜ë©°, ì˜ˆì œëŠ” ì—†ìŒ 
{:.prompt-tip}

- íŒì›¨ì–´ ë™ì‘ í™•ì¸: HBIì™€ ARCHì˜ ê¸°ë³¸ê°’ (0x178, 0x5) í™•ì¸

```bash
$ make
$ make debug
```

![QEMU ì‹¤í–‰ ì´ë¯¸ì§€](/assets/img/OS/os215.png)

```bash
$ make gdb
```

![gdb ì‹¤í–‰ ì´ë¯¸ì§€](/assets/img/OS/os216.png)

### [Error] `make gdb` ì‹¤í–‰ ì˜¤ë¥˜ í•´ê²° ë°©ë²• 1
ì´ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•´ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.[https://goobgood.tistory.com/31](https://goobgood.tistory.com/31)<br>

1. GNU Tool Chain ì„¤ì¹˜ í•„ìš”
   - [GNU Tool Chain ë‹¤ìš´ë¡œë“œ ë§í¬](https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads)
2. ê¸°ì¡´ íŒ¨í‚¤ì§€ ì‚­ì œ

```bash
$ sudo apt remove gcc-arm-none-eabi
```

3. ë‹¤ìš´ë¡œë“œ ë°›ì€ íŒ¨í‚¤ì§€ ì••ì¶• í•´ì œ í›„ ì‹¬ë³¼ë¦­ ë§í¬ ìƒì„±

```bash
$ sudo tar xjf gcc-arm-none-eabi-10.3-2021.10-x86_64-linux.tar.bz2 -C /usr/share
$ sudo ln -s /usr/share/gcc-arm-none-eabi-10.3-2021.10/bin/arm-none-eabi-gcc /usr/bin/arm-none-eabi-gcc 
$ sudo ln -s /usr/share/gcc-arm-none-eabi-10.3-2021.10/bin/arm-none-eabi-g++ /usr/bin/arm-none-eabi-g++
$ sudo ln -s /usr/share/gcc-arm-none-eabi-10.3-2021.10/bin/arm-none-eabi-gdb /usr/bin/arm-none-eabi-gdb
$ sudo ln -s /usr/share/gcc-arm-none-eabi-10.3-2021.10/bin/arm-none-eabi-size /usr/bin/arm-none-eabi-size
```

4. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ (í•„ìš” ì‹œ)

![ì˜ì¡´ì„± ì„¤ì¹˜ ì´ë¯¸ì§€](/assets/img/OS/os217.png)

ìœ„ì™€ ê°™ì€ ì¶œë ¥ì´ ë°œìƒí•  ê²½ìš° ì˜ì¡´ì„± íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
$ sudo apt install libncurses5
```

### [Error] `make gdb` ì‹¤í–‰ ì˜¤ë¥˜ í•´ê²° ë°©ë²• 2

ì•„ë˜ ê¹ƒí—ˆë¸Œ ì»¤ë°‹ì„ ì°¸ê³ í•©ë‹ˆë‹¤.

[https://github.com/navilera/Navilos/commit/145fb5b9fef4cf0d5bb6d8957a0090a2316938cf](https://github.com/navilera/Navilos/commit/145fb5b9fef4cf0d5bb6d8957a0090a2316938cf)

```bash
...
gdb:
    arm-none-eabi-gdb // ì‚­ì œ
    gdb-multiarch $(navilos) // ì¶”ê°€
...
```

- Makefileì—ì„œ gdbë¥¼ `gdb-multiarch`ë¡œ ìˆ˜ì •


### QEMU ì—°ê²° í›„ í™•ì¸
```bash
$ make gdb
(gdb) target remote:1234
(gdb) file build/navilos.axf
```
- `target` ëª…ë ¹ìœ¼ë¡œ QEMU ë””ë²„ê¹… ì†Œì¼“ ì—°ê²° í›„, `file` ëª…ë ¹ìœ¼ë¡œ `navilos.axf` ì½ê¸°
- `list` ëª…ë ¹ìœ¼ë¡œ ë””ë²„ê¹… ì‹¬ë²Œ í™•ì¸

![ë””ë²„ê¹… ì‹¬ë²Œ í™•ì¸ ì´ë¯¸ì§€](/assets/img/OS/os219.png)

- QEMUëŠ” ì•„ì§ ì‹¤í–‰ íŒŒì¼ì„ ì‹¤í–‰í•˜ì§€ ì•Šì€ ìƒíƒœ
- `info register` ëª…ë ¹ìœ¼ë¡œ ë ˆì§€ìŠ¤í„° ê°’ í™•ì¸ (ëª¨ë‘ 0)

```bash
(gdb) s
(gdb) info register
```

![ë ˆì§€ìŠ¤í„° ê°’ í™•ì¸ ì´ë¯¸ì§€ 1](/assets/img/OS/os220.png)

- ì²« ë²ˆì§¸ ëª…ë ¹ ì‹¤í–‰ í›„, R0ì— 0x10000000 ì €ì¥ í™•ì¸
- ë‹¤ìŒ ì¤„ ì‹¤í–‰ ì‹œ, ë©”ëª¨ë¦¬ ì£¼ì†Œ 0x10000000ì—ì„œ ê°’ì„ ì½ì–´ R1ì— ì €ì¥í•˜ê³  0x178 í¬í•¨ ì—¬ë¶€ í™•ì¸

```bash
(gdb) s
(gdb) i r
```

![ë ˆì§€ìŠ¤í„° ê°’ í™•ì¸ ì´ë¯¸ì§€ 2](/assets/img/OS/os221.png)

- R1ì— 0x178ê³¼ 0x5 í¬í•¨ í™•ì¸ (HBIì™€ ARCH í•­ëª©)
- íŒì›¨ì–´ì™€ QEMUê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•¨ì„ í™•ì¸

## ìš”ì•½
***
- ì†ŒìŠ¤ ì½”ë“œ ì‘ì„± ë° ì»´íŒŒì¼, í•˜ë“œì›¨ì–´ì—ì„œì˜ ì‹¤í–‰ í™•ì¸
- ë ˆì§€ìŠ¤í„° ì ‘ê·¼ ë° gdb ì‚¬ìš©ì„ í†µí•´ í•˜ë“œì›¨ì–´ ë™ì‘ í™•ì¸
- ì´ì œ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ, ë‹¤ìŒ ì¥ë¶€í„° í”„ë¡œì íŠ¸ ì‹œì‘

## ì°¸ê³ 
***

ì°¸ê³  ê¹ƒí—ˆë¸Œ : [https://github.com/navilera/Navilos](https://github.com/navilera/Navilos)

ì´ë§Œìš° ì €ìë‹˜ì˜ ë¸”ë¡œê·¸ ì£¼ì†Œ : [https://kldp.org/node/162560](https://kldp.org/node/162560)
